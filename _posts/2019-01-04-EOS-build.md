# EOS Build

1. EOS fork
2. 내 repository 에서 clone
    ```console
    >git clone https://github.com/$MY_REPOSITORY/eos.git
    >cd eos 
    ```
3. upstream 설정
    ```console
    >git remote add upstream https://github.com/EOSIO/eos.git
    ```
    origin 과 upstream 이 제대로 설정되었는지 확인
    ```
    >git remote -v
    ```
    
    결과
    ```console
    origin	https://github.com/$MY_REPOSITORY/eos.git (fetch)
    origin	https://github.com/$MY_REPOSITORY/eos.git (push)
    upstream	https://github.com/EOSIO/eos.git (fetch)
    upstream	https://github.com/EOSIO/eos.git (push)
    ```
4. stable release version 으로 checkout
    
    2019년 1월 현재 stable release version 은 `v1.5.2`이다.
    
    release version 은 upstream 저장소에서 tag 로 등록이 되어있고, fork 시에 자신의 origin 저장소에 자동으로 유지된다.
    
    release version 들에 대한 정보는 https://github.com/EOSIO/eos/releases 에서 확인할 수 있다.
     * 참고로 RC 는 release candidate 라는 의미로, 다음 버전 release 를 위한 후보가 되는 커밋 시점을 구분하기 위해서 쓴다. 마지막으로 테스트하고 준비하기 위한 버전이라고 보면 된다. 정식 release version 이 아니다. 
    
    현재 version 이 붙은 태그들 확인
    ```console
    >git tag -l "v*"
    ```
    
    v1.5.2 로 checkout
     * tag 로 checkout 하면 branch 정보가 없다. 알아보기 쉽게 브랜치도 생성하면서 checkout 을 해주자.
    ```console
    >git checkout v1.5.2 -b v1.5.2 
    ```
    
    branch 의 정보를 확인하고 commit id 가 해당 버전이 맞는지 확인한다.
    ```console
    >git branch -v
    ```
    
    다음과 같은 결과를 확인할 수 있다. master 브랜치와 commit id 가 다르다.
    ```console
      master ced8d7db0 Merge pull request #6547 from EOSIO/release/1.5.x
    * v1.5.2 d34240966 Merge pull request #6504 from EOSIO/release/1.5.x
    ```
    
5. submodule 들 update
    
    이 상태로 빌드 스크립트 ```./eosio_build.sh``` 를 실행하면 git 이 다음과 같은 메세지를 내뱉는다.
    
    ```console
    git submodules are not up to date.
	Please run the command 'git submodule update --init --recursive'.
	```
	
	안내 대로 위 명령어를 실행 시켜서 eos 가 사용하는 다른 모듈들을 다운로드 하자.
	 * 현재 EOS 는 cpp 구현체 프로젝트로 다른 cpp 모듈들을 많이 사용하고 있다. eos github 에서는 해당 모듈들을 링크만 해놓고 있다고 이해하면 된다. 빌드가 필요할 때 해당 모듈들을 다운로드 받아서 빌드한다. 이 명령어는 링크가 걸려있는 모듈들을 다운로드 하겠다는 git 에서 제공하는 명령어이다.
	
	```console
	>git submodule update --init --recursive
	```
	
	다음과 같은 결과를 확인할 수 있다.
	```console
    Submodule 'contracts/libc++/upstream' (https://github.com/EOSIO/libcxx.git) registered for path 'contracts/libc++/upstream'
    Submodule 'contracts/musl/upstream' (https://github.com/EOSIO/musl.git) registered for path 'contracts/musl/upstream'
    Submodule 'externals/binaryen' (https://github.com/EOSIO/binaryen) registered for path 'externals/binaryen'
    Submodule 'externals/magic_get' (https://github.com/EOSIO/magic_get) registered for path 'externals/magic_get'
    Submodule 'libraries/appbase' (https://github.com/eosio/appbase) registered for path 'libraries/appbase'
    Submodule 'libraries/chainbase' (https://github.com/eosio/chainbase) registered for path 'libraries/chainbase'
    Submodule 'libraries/fc' (https://github.com/EOSIO/fc) registered for path 'libraries/fc'
    Submodule 'libraries/softfloat' (https://github.com/eosio/berkeley-softfloat-3) registered for path 'libraries/softfloat'
    Submodule 'libraries/wabt' (http://github.com/EOSIO/wabt) registered for path 'libraries/wabt'
    Cloning into '/Users/user/dev/eos/eos/contracts/libc++/upstream'...
    Cloning into '/Users/user/dev/eos/eos/contracts/musl/upstream'...
    Cloning into '/Users/user/dev/eos/eos/externals/binaryen'...
    Cloning into '/Users/user/dev/eos/eos/externals/magic_get'...
    Cloning into '/Users/user/dev/eos/eos/libraries/appbase'...
    Cloning into '/Users/user/dev/eos/eos/libraries/chainbase'...
    Cloning into '/Users/user/dev/eos/eos/libraries/fc'...
    Cloning into '/Users/user/dev/eos/eos/libraries/softfloat'...
    Cloning into '/Users/user/dev/eos/eos/libraries/wabt'...
    warning: redirecting to https://github.com/EOSIO/wabt/
    Submodule path 'contracts/libc++/upstream': checked out '2880ac42909d4bb29687ed079f8bb4405c3b0869'
    Submodule path 'contracts/musl/upstream': checked out '8a34536ac9764c90c86cc0b62d0cda07449fd5d8'
    Submodule path 'externals/binaryen': checked out '16d641f62ab14df845c87a63efe4d991b508d19a'
    Submodule path 'externals/magic_get': checked out '89fda1da702e6c76a22bfb6233e9e3d0641708ec'
    Submodule path 'libraries/appbase': checked out '1d6e6e4a0b334553658fe05cfa1e86081b6d0b4a'
    Submodule path 'libraries/chainbase': checked out '8ca96ad6b18709d65a7d1f67f8893978f25babcf'
    Submodule path 'libraries/fc': checked out 'a8613d3786cddfcc336808d2b9b7df655e6cc6d1'
    Submodule 'secp256k1/upstream' (https://github.com/cryptonomex/secp256k1-zkp.git) registered for path 'libraries/fc/secp256k1/upstream'
    Cloning into '/Users/user/dev/eos/eos/libraries/fc/secp256k1/upstream'...
    Submodule path 'libraries/fc/secp256k1/upstream': checked out 'bd067945ead3b514fba884abd0de95fc4b5db9ae'
    Submodule path 'libraries/softfloat': checked out '203b6df7dedc5bae1b2a7b1b23562335a6344578'
    Submodule path 'libraries/wabt': checked out 'bf353aa719c88b7152ee09e7f877a507cb7df27b'
    Submodule 'third_party/gtest' (https://github.com/google/googletest) registered for path 'libraries/wabt/third_party/gtest'
    Submodule 'third_party/ply' (https://github.com/dabeaz/ply) registered for path 'libraries/wabt/third_party/ply'
    Submodule 'third_party/testsuite' (https://github.com/WebAssembly/testsuite) registered for path 'libraries/wabt/third_party/testsuite'
    Cloning into '/Users/user/dev/eos/eos/libraries/wabt/third_party/gtest'...
    Cloning into '/Users/user/dev/eos/eos/libraries/wabt/third_party/ply'...
    Cloning into '/Users/user/dev/eos/eos/libraries/wabt/third_party/testsuite'...
    Submodule path 'libraries/wabt/third_party/gtest': checked out '7888184f28509dba839e3683409443e0b5bb8948'
    Submodule path 'libraries/wabt/third_party/ply': checked out 'd776a2ece6c12bf8f8b6a0e65b48546ac6078765'
    Submodule path 'libraries/wabt/third_party/testsuite': checked out '0b7f00081c62321a96ed67f5f651408c4ae17ec0'
	```
	
	`!주의 : 이 과정은 내가 빌드하고자 하는 커밋 시점으로 체크아웃을 한 뒤에 수행해야 한다.`
	
6. 빌드 스크립트 실행

    ㅇ
    
    다음과 같은 결과를 뱉는다.
    ```console
    
	Beginning build version: 1.2
    Fri Jan  4 01:57:27 UTC 2019
    User: user
    git head id: ced8d7db063371aabe8deadb4120767a1d2406a0
    Current branch: heads/v1.5.2
    
    ARCHITECTURE: Darwin
    
    OS name: Darwin
    OS Version: 10.14.1
    CPU speed: 2.20Ghz
    CPU cores: 6
    Physical Memory: 16 Gbytes
    Disk install: /dev/disk1s1
    Disk space total: 188G
    Disk space available: 100G
    
    Checking xcode-select installation
    xcode-select installation found @
    /usr/bin/xcode-select
    
    Checking Ruby installation.
    Ruby installation found @
    /usr/bin/ruby
    
    Checking Home Brew installation
    Home Brew installation found @
    /usr/local/bin/brew
    
    Checking dependencies.
    Checking automake ... 		 automake NOT found.
    Checking Libtool ... 		 Libtool NOT found.
    Checking OpenSSL ... 		 OpenSSL found
    Checking llvm ... 		 llvm NOT found.
    Checking wget ... 		 wget NOT found.
    Checking CMake ... 		 CMake NOT found.
    Checking GMP ... 		 GMP NOT found.
    Checking gettext ... 		 gettext NOT found.
    Checking MongoDB ... 		 MongoDB NOT found.
    Checking Doxygen ... 		 Doxygen NOT found.
    Checking Graphviz ... 		 Graphviz NOT found.
    Checking LCOV ... 		 LCOV NOT found.
    Checking Python3 ... 		 Python3 found
    
    The following dependencies are required to install EOSIO.
    
    1. automake
    2. Libtool
    3. llvm
    4. wget
    5. CMake
    6. GMP
    7. gettext
    8. MongoDB
    9. Doxygen
    10. Graphviz
    11. LCOV
    
    
    Do you wish to install these packages?
    1) Yes
    2) No
    #?

    ```
    위 내용은 빌드를 하기 위해 필요한 프로그램들이 설치되어 있는지를 확인한 결과이다.
    필자의 경우 OpenSSL 과 Python3 는 설치되어있었고, 나머지는 설치되어있지 않았다.
    ```1``` 을 입력하고 엔터를 누르면 위에 NOT found 된 패키지들을 설치한다.
     * 필자는 macOS 환경에서 진행했다. mac 의 경우 homebrew 를 통해서 설치를 진행하는 것을 알 수 있다.